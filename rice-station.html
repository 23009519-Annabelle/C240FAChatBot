<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rice Station | Smart Cooking Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        chef: {
                            base: '#FDFBF7',
                            dark: '#2C3E3D',
                            primary: '#5B8FB9',
                            primary_dark: '#304D6D',
                            primary_light: '#B6D0E2',
                            cream: '#FDFBF7',
                            gray: '#9CA3AF',
                            subtle: '#F9F7F4'
                        }
                    },
                    fontFamily: {
                        sans: ['DM Sans', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #FDFBF7; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-enter { opacity: 0; transform: translateY(10px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 0.3s, transform 0.3s; }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Print Styles - Critical Fix: Use display:none to prevent blank pages */
        @media print {
            /* 1. Hide everything by default */
            body > * {
                display: none !important;
            }
            
            /* 2. ONLY display the active modal and override hidden state */
            body > #recipeModal:not(.hidden) {
                display: block !important;
                position: relative !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
                background: white !important;
            }
            
            body > #shoppingListModal:not(.hidden) {
                display: flex !important;
                position: relative !important;
                align-items: flex-start !important;
                justify-content: center !important;
                background: white !important;
            }
            
            body > #cookModeOverlay:not(.hidden) {
                display: block !important;
                position: relative !important;
                background: white !important;
            }
            
            /* 3. Ensure internal modal contents are visible */
            #recipeModal * { visibility: visible !important; }
            #shoppingListModal * { visibility: visible !important; }
            #cookModeOverlay * { visibility: visible !important; }
            
            /* 4. Clean up modal for printing */
            #modalPanel {
                position: relative !important;
                max-width: 100% !important;
                width: 100% !important;
                transform: none !important;
                box-shadow: none !important;
                background: white !important;
            }
            
            /* 5. Hide buttons, overlays, and navigation */
            #recipeModal button,
            #shoppingListModal button,
            #cookModeOverlay button,
            #recipeModal > div:first-child,
            #shoppingListModal > div:first-child,
            #cookModeOverlay > div:first-child,
            #cookModeOverlay > div:last-child {
                display: none !important;
            }
            
            /* 6. Force white background everywhere to save ink */
            body, #recipeModal, #modalPanel, #shoppingListModal, #cookModeOverlay {
                background: white !important;
            }
            
            /* 7. Reset page margins for clean printing */
            @page {
                margin: 0.5cm;
                size: auto;
            }
        }
        
        @keyframes shuffle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }
        
        .shuffle-animation {
            animation: shuffle 0.3s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .toast {
            animation: slideUp 0.3s ease-out;
        }
        
        @media (max-width: 768px) {
            .mobile-bottom-bar {
                display: flex !important;
            }
        }
    </style>
</head>
<body class="text-chef-dark antialiased min-h-screen relative">

    <nav class="fixed w-full z-40 bg-chef-base/95 backdrop-blur-lg border-b border-chef-primary_light/30 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20">
                <div class="flex items-center gap-3 md:gap-4">
                    <div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-chef-primary to-chef-primary_dark text-white rounded-2xl md:rounded-3xl flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-utensils text-sm"></i>
                    </div>
                    <div>
                        <h1 class="font-serif text-lg md:text-xl font-bold tracking-tight text-chef-dark">Rice Station</h1>
                        <p class="text-xs text-chef-gray uppercase tracking-widest hidden sm:block">Organic Cooking</p>
                    </div>
                </div>
                <div class="hidden md:flex gap-4 items-center">
                    <button id="filter-all" class="nav-filter text-sm font-medium hover:text-chef-primary transition border-b-2 border-transparent min-h-[44px]" onclick="filterBy('all')">All Recipes</button>
                    <button id="filter-easy" class="nav-filter text-sm font-medium hover:text-chef-primary transition border-b-2 border-transparent min-h-[44px]" onclick="filterBy('Very Easy')">Quick & Easy</button>
                    <button id="filter-veg" class="nav-filter text-sm font-medium hover:text-chef-primary transition border-b-2 border-transparent min-h-[44px]" onclick="filterBy('Vegetarian')">Vegetarian</button>
                    <button onclick="toggleMealPlan()" class="ml-4 w-11 h-11 bg-gradient-to-br from-chef-primary to-chef-primary_dark hover:from-chef-primary_dark hover:to-chef-primary text-white rounded-3xl flex items-center justify-center transition-all hover:scale-105 shadow-lg hover:shadow-xl relative" title="My Meal Plan">
                        <i class="fa-solid fa-calendar-days"></i>
                        <span id="mealPlanCount" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-chef-primary_dark text-white text-xs rounded-full flex items-center justify-center font-bold shadow-md">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="pt-32 pb-20 px-4 max-w-7xl mx-auto">
        
        <div class="mb-12 md:mb-16 text-center max-w-2xl mx-auto">
            <span class="text-chef-primary font-bold text-xs md:text-sm tracking-widest uppercase mb-2 block">Organic Solo Edition</span>
            <h2 class="font-serif text-3xl md:text-4xl lg:text-5xl font-bold mb-4 md:mb-6 text-chef-dark leading-tight px-4">Master the Art of One-Pot Rice</h2>
            <p class="text-base md:text-lg text-chef-gray leading-relaxed mb-6 md:mb-8 px-4">
                Curated recipes for mindful cooking. Minimal ingredients, maximum flavor, and absolutely zero waste.
            </p>
            <button onclick="surpriseMe()" class="bg-gradient-to-r from-chef-primary to-chef-primary_dark hover:from-chef-primary_dark hover:to-chef-primary text-white px-6 md:px-8 py-3 md:py-4 min-h-[44px] rounded-3xl font-semibold text-base md:text-lg shadow-lg hover:shadow-xl transition-all transform hover:scale-105 flex items-center gap-3 mx-auto">
                <i class="fa-solid fa-dice text-xl md:text-2xl"></i>
                <span>Can't Decide? Surprise Me!</span>
            </button>
        </div>

        <div id="recipeGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
        </div>

    </main>

    <div id="recipeModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        
        <div class="absolute inset-0 md:inset-y-0 md:right-0 md:left-auto md:max-w-2xl w-full bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300 translate-x-full md:rounded-l-3xl" id="modalPanel">
            <div class="relative">
                <div class="h-64 w-full relative">
                    <img id="modalImage" src="" class="w-full h-full object-cover">
                    <div class="absolute top-4 right-4 flex gap-2">
                        <button onclick="printRecipe()" class="bg-white/90 p-3 rounded-2xl shadow-lg hover:bg-white transition" title="Print Recipe">
                            <i class="fa-solid fa-print text-lg flex items-center justify-center text-chef-sage"></i>
                        </button>
                        <button onclick="closeModal()" class="bg-white/90 p-3 rounded-2xl shadow-lg hover:bg-white transition">
                            <i class="fa-solid fa-xmark text-lg flex items-center justify-center text-chef-dark"></i>
                        </button>
                    </div>
                </div>

                <div class="p-6 md:p-8 lg:p-12">
                    <span id="modalTag" class="text-xs font-bold tracking-widest uppercase text-chef-primary mb-2 block"></span>
                    <h2 id="modalTitle" class="font-serif text-2xl md:text-3xl lg:text-4xl font-bold mb-2 text-chef-dark"></h2>
                    <p id="modalDesc" class="text-sm md:text-base text-chef-gray italic mb-6 border-l-4 border-chef-primary_light pl-4 rounded-l-lg"></p>

                    <div class="flex gap-6 mb-8 py-4 border-t border-b border-gray-100">
                        <div>
                            <span class="block text-xs text-gray-400 uppercase">Time</span>
                            <span id="modalTime" class="font-bold"></span>
                        </div>
                        <div>
                            <span class="block text-xs text-gray-400 uppercase">Difficulty</span>
                            <span id="modalDiff" class="font-bold"></span>
                        </div>
                         <div>
                            <span class="block text-xs text-gray-400 uppercase">Serves</span>
                            <span class="font-bold">1 Person (Solo)</span>
                        </div>
                    </div>

                    <!-- Portion Scaler -->
                    <div class="mb-6 p-4 bg-chef-subtle rounded-3xl border border-chef-primary_light/20 shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-bold text-chef-dark text-sm mb-1">Portion Size</h4>
                                <p class="text-xs text-chef-gray">Scale ingredients for more servings</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="setPortionScale(1)" class="portion-btn w-12 h-11 min-h-[44px] rounded-xl border-2 border-chef-primary bg-white hover:bg-chef-primary hover:text-white transition-all font-bold text-sm shadow-sm" data-scale="1">1x</button>
                                <button onclick="setPortionScale(2)" class="portion-btn w-12 h-11 min-h-[44px] rounded-xl border-2 border-chef-primary_light bg-white hover:bg-chef-primary hover:text-white transition-all font-bold text-sm shadow-sm" data-scale="2">2x</button>
                                <button onclick="setPortionScale(3)" class="portion-btn w-12 h-11 min-h-[44px] rounded-xl border-2 border-chef-primary_light bg-white hover:bg-chef-primary hover:text-white transition-all font-bold text-sm shadow-sm" data-scale="3">3x</button>
                            </div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="font-serif text-xl font-bold mb-4">Ingredients</h3>
                            <ul id="modalIngredients" class="space-y-3 text-sm text-gray-700"></ul>
                        </div>
                        <div>
                            <h3 class="font-serif text-xl font-bold mb-4">Instructions</h3>
                            <div id="modalSteps" class="space-y-6 text-sm text-gray-700"></div>
                        </div>
                    </div>

                    <div class="mt-8 p-4 bg-chef-subtle rounded-lg">
                        <h4 class="font-bold text-chef-dark mb-1"><i class="fa-solid fa-lightbulb text-yellow-500 mr-2"></i>Chef's Secret Tip</h4>
                        <p id="modalTip" class="text-sm text-gray-600"></p>
                    </div>
                    
                    <!-- Cook Mode Button -->
                    <div class="mt-6">
                        <button onclick="enterCookMode()" class="w-full bg-gradient-to-r from-chef-dark to-gray-700 hover:from-gray-700 hover:to-chef-dark text-white py-4 min-h-[44px] rounded-3xl font-bold text-base transition-all hover:scale-105 shadow-lg flex items-center justify-center gap-3">
                            <i class="fa-solid fa-fire text-2xl"></i>
                            <span>Start Cook Mode</span>
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                    
                    <div class="mt-6 flex gap-3">
                        <button onclick="shareRecipe()" class="flex-1 bg-gradient-to-r from-chef-primary to-chef-primary_dark hover:from-chef-primary_dark hover:to-chef-primary text-white py-3 min-h-[44px] rounded-3xl font-medium text-sm transition-all hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                            <i class="fa-solid fa-share-nodes"></i>
                            Share Recipe
                        </button>
                        <button onclick="addRecipeToMealPlan(currentRecipeId)" class="flex-1 border-2 border-chef-primary text-chef-primary hover:bg-chef-primary hover:text-white py-3 min-h-[44px] rounded-3xl font-medium text-sm transition-all hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                            <i class="fa-solid fa-calendar-plus"></i>
                            Add to Plan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meal Plan Sidebar -->
    <div id="mealPlanSidebar" class="fixed inset-0 md:inset-y-0 md:right-0 md:left-auto z-50 w-full md:w-96 md:max-w-md bg-white shadow-2xl transform translate-x-full transition-transform duration-300 md:rounded-l-3xl">
        <div class="h-full flex flex-col">
            <!-- Header -->
            <div class="px-6 py-5 border-b border-chef-primary_light/30 bg-gradient-to-r from-chef-primary/10 to-transparent">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-chef-primary to-chef-primary_dark rounded-3xl flex items-center justify-center shadow-lg">
                            <i class="fa-solid fa-calendar-days text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-chef-dark">My Meal Plan</h3>
                            <p class="text-xs text-gray-500" id="mealPlanSubtitle">No recipes saved yet</p>
                        </div>
                    </div>
                    <button onclick="toggleMealPlan()" class="w-11 h-11 min-h-[44px] rounded-full hover:bg-gray-100 flex items-center justify-center transition">
                        <i class="fa-solid fa-xmark text-gray-600 text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- Saved Recipes List -->
            <div id="mealPlanList" class="flex-1 overflow-y-auto p-6">
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">ðŸ“…</div>
                    <h4 class="font-serif text-xl font-bold text-chef-dark mb-2">Start Planning Your Meals</h4>
                    <p class="text-sm text-gray-500">Add recipes to your meal plan to get started!</p>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="p-6 border-t border-chef-primary_light/30 bg-chef-subtle">
                <button onclick="generateShoppingList()" id="generateListBtn" class="w-full bg-gradient-to-r from-chef-primary to-chef-primary_dark hover:from-chef-primary_dark hover:to-chef-primary text-white py-3 min-h-[44px] rounded-3xl font-semibold text-sm transition-all hover:scale-105 shadow-lg flex items-center justify-center gap-2" disabled>
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span>Generate Shopping List</span>
                </button>
                <button onclick="showClearConfirmModal()" class="w-full mt-3 text-chef-primary_dark hover:text-chef-dark py-3 min-h-[44px] text-sm font-medium transition">
                    Clear All Plans
                </button>
            </div>
        </div>
    </div>

    <!-- Shopping List Modal -->
    <div id="shoppingListModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity" onclick="closeShoppingList()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] md:max-h-[80vh] flex flex-col overflow-hidden transform transition-transform">
                <!-- Header -->
                <div class="px-6 py-5 border-b border-chef-primary_light/30 bg-gradient-to-r from-chef-primary/10 to-transparent flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-chef-primary to-chef-primary_dark rounded-3xl flex items-center justify-center shadow-lg">
                                <i class="fa-solid fa-cart-shopping text-white"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-chef-dark">Shopping List</h3>
                                <p class="text-xs text-gray-500" id="shoppingListSubtitle">For your meal plan</p>
                            </div>
                        </div>
                        <button onclick="closeShoppingList()" class="w-11 h-11 min-h-[44px] rounded-full hover:bg-gray-100 flex items-center justify-center transition">
                            <i class="fa-solid fa-xmark text-gray-600 text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- Shopping List Content -->
                <div id="shoppingListContent" class="flex-1 overflow-y-auto p-6">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Footer -->
                <div class="p-6 border-t border-chef-primary_light/30 bg-chef-subtle flex-shrink-0">
                    <button onclick="printShoppingList()" class="w-full bg-gradient-to-r from-chef-primary to-chef-primary_dark hover:from-chef-primary_dark hover:to-chef-primary text-white py-3 min-h-[44px] rounded-3xl font-semibold text-sm transition-all hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                        <i class="fa-solid fa-print"></i>
                        Print Shopping List
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] hidden">
        <div class="toast bg-white border-2 border-chef-primary text-chef-dark px-6 py-4 rounded-3xl shadow-xl flex items-center gap-3">
            <i class="fa-solid fa-check-circle text-chef-primary"></i>
            <span id="toastMessage" class="font-medium">Success!</span>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="closeConfirmModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-6 md:p-8 transform transition-transform">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-chef-primary to-chef-primary_dark rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="fa-solid fa-question text-white text-2xl"></i>
                    </div>
                    <h3 class="font-serif text-xl md:text-2xl font-bold text-chef-dark mb-2" id="confirmTitle">Confirm Action</h3>
                    <p class="text-chef-gray text-sm md:text-base" id="confirmMessage">Are you sure?</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeConfirmModal()" class="flex-1 border-2 border-gray-300 text-chef-dark hover:bg-gray-50 py-3 min-h-[44px] rounded-3xl font-medium transition">
                        Cancel
                    </button>
                    <button id="confirmBtn" class="flex-1 bg-gradient-to-r from-chef-primary to-chef-primary_dark hover:from-chef-primary_dark hover:to-chef-primary text-white py-3 min-h-[44px] rounded-3xl font-medium transition-all hover:scale-105 shadow-lg">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cook Mode Overlay -->
    <div id="cookModeOverlay" class="fixed inset-0 z-[110] hidden bg-chef-base overflow-y-auto">
        <!-- Header -->
        <div class="sticky top-0 z-10 bg-white/95 backdrop-blur-lg shadow-md border-b border-chef-primary_light/30">
            <div class="max-w-4xl mx-auto px-4 md:px-6 py-3 md:py-4 flex items-center justify-between">
                <div class="flex items-center gap-3 md:gap-4">
                    <div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-chef-primary to-chef-primary_dark rounded-3xl flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-fire text-white text-lg md:text-xl"></i>
                    </div>
                    <div>
                        <h2 id="cookModeTitle" class="font-serif text-lg md:text-2xl font-bold text-chef-dark">Recipe Title</h2>
                        <p class="text-xs md:text-sm text-chef-gray">Cook Mode Active</p>
                    </div>
                </div>
                <button onclick="exitCookMode()" class="w-11 h-11 md:w-12 md:h-12 min-h-[44px] rounded-3xl bg-chef-primary_light/20 hover:bg-rose-500 hover:text-white flex items-center justify-center transition-all">
                    <i class="fa-solid fa-xmark text-xl md:text-2xl"></i>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="max-w-4xl mx-auto px-4 md:px-6 py-6 md:py-8 pb-32">
            <!-- Ingredients Section -->
            <div class="mb-8 md:mb-12 bg-white rounded-3xl shadow-lg p-6 md:p-8 border border-chef-primary_light/20">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-br from-chef-primary to-chef-primary_dark rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-list text-white"></i>
                    </div>
                    <h3 class="font-serif text-2xl md:text-3xl font-bold text-chef-dark">Ingredients</h3>
                </div>
                <ul id="cookModeIngredients" class="space-y-3 text-base md:text-xl text-chef-dark">
                    <!-- Will be populated by JS -->
                </ul>
            </div>

            <!-- Steps Section -->
            <div class="bg-white rounded-3xl shadow-lg p-6 md:p-8 border border-chef-primary_light/20">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-br from-chef-primary to-chef-primary_dark rounded-xl flex items-center justify-center">
                        <i class="fa-solid fa-utensils text-white"></i>
                    </div>
                    <h3 class="font-serif text-2xl md:text-3xl font-bold text-chef-dark">Instructions</h3>
                </div>
                <div id="cookModeSteps" class="space-y-4 md:space-y-6">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <!-- Tip Section -->
            <div id="cookModeTipSection" class="mt-8 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-3xl shadow-lg p-8 border border-amber-200">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-yellow-400 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-md">
                        <i class="fa-solid fa-lightbulb text-white text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-xl text-chef-dark mb-2">Chef's Secret Tip</h4>
                        <p id="cookModeTip" class="text-lg text-gray-700"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Progress Bar -->
        <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg shadow-2xl border-t border-chef-primary_light/30 p-4 md:p-6">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <div>
                    <p class="text-xs md:text-sm text-chef-gray mb-1">Progress</p>
                    <p class="text-xl md:text-2xl font-bold text-chef-dark"><span id="cookModeProgress">0</span> / <span id="cookModeTotal">0</span> Steps</p>
                </div>
                <button onclick="exitCookMode()" class="bg-gradient-to-r from-chef-primary to-chef-primary_dark hover:from-chef-primary_dark hover:to-chef-primary text-white px-6 md:px-8 py-3 md:py-4 min-h-[44px] rounded-3xl font-bold text-base md:text-lg transition-all hover:scale-105 shadow-lg flex items-center gap-2">
                    <i class="fa-solid fa-check"></i>
                    <span class="hidden sm:inline">Finish Cooking</span>
                    <span class="sm:hidden">Done</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Sticky Bottom Navigation -->
    <div class="mobile-bottom-bar hidden fixed bottom-0 left-0 right-0 z-50 bg-chef-base/95 backdrop-blur-lg border-t border-chef-primary_light/30 shadow-lg md:hidden">
        <div class="flex justify-around items-center py-3 px-4">
            <button onclick="scrollToTop()" class="flex flex-col items-center gap-1 text-chef-dark hover:text-chef-primary transition min-w-[60px] py-2">
                <i class="fa-solid fa-house text-xl"></i>
                <span class="text-xs font-medium">Home</span>
            </button>
            <button onclick="surpriseMe()" class="flex flex-col items-center gap-1 text-chef-dark hover:text-chef-primary transition relative min-w-[60px]">
                <div class="absolute -top-2 w-12 h-12 bg-gradient-to-br from-chef-primary to-chef-primary_dark rounded-3xl flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-dice text-white text-xl"></i>
                </div>
                <span class="text-xs font-medium mt-11">Random</span>
            </button>
        </div>
    </div>


    <script>
        const recipes = [
            {
                id: 1,
                title: "Whole Tomato Rice",
                time: "40 mins",
                diff: "Very Easy",
                tag: "One-Pot Wonder",
                image: "https://cookingbomb.com/cdn/shop/articles/tomatorice_1340x550_crop_center.jpg?v=1728614364",
                desc: "The ultimate 'set it and forget it' meal where a single tomato creates a rich sauce.",
                ingredients: ["1 cup Rice (Short-grain/Jasmine)", "1 medium Ripe Tomato", "1 tbsp Soy sauce & Oyster sauce", "Â¼ cup Frozen peas or corn", "Â½ link Lap Cheong (optional)"],
                steps: [
                    "Rinse {scale} cup(s) of rice until water is clear. Drain well.",
                    "Add rice, soy sauce, oyster sauce, salt, and pepper to pot.",
                    "Add water just below the {scale}-cup mark.",
                    "Cut a shallow 'X' on top of {scale} tomato(es) and place in center.",
                    "Scatter toppings around tomato and run standard rice cycle.",
                    "Mash tomato and mix thoroughly before serving."
                ],
                tip: "Reducing water slightly is crucial. The tomato adds moisture!"
            },
            {
                id: 2,
                title: "Lap Cheong Rice",
                time: "25 mins",
                diff: "Very Easy",
                tag: "Emergency Dinner",
                image: "https://thewoksoflife.com/wp-content/uploads/2021/09/Lap-Cheong-Rice-6.jpg",
                desc: "Savory, nostalgic, and uses shelf-stable ingredients.",
                ingredients: ["1 cup Jasmine rice", "1 link Lap Cheong", "1 tsp Dark soy sauce (optional)", "Water (Standard ratio)"],
                steps: [
                    "Wash {scale} cup(s) of rice and place in cooker.",
                    "Use the 'Finger Trick' for water level.",
                    "Place {scale} whole Lap Cheong link(s) on top of rice.",
                    "Cook. The steam renders the fat into the rice.",
                    "Slice sausage diagonally and serve over rice."
                ],
                tip: "Master the 'Finger Trick' for perfect water ratio."
            },
            {
                id: 3,
                title: "Mushroom & Corn Rice",
                time: "25 mins",
                diff: "Easy",
                tag: "Vegetarian",
                image: "https://foodiecorner.wordpress.com/wp-content/uploads/2011/03/mushroom-rice.jpg?w=640",
                desc: "A buttery, umami-packed vegetarian bowl.",
                ingredients: ["1 cup Rice & Water", "Â½ tsp Dashi powder", "Â½ cup Shimeji mushrooms", "Â¼ cup Canned corn", "1 thin slice Butter"],
                steps: [
                    "Add washed rice, water, dashi, and soy sauce. Stir once.",
                    "Layer mushrooms and corn on top. DO NOT stir.",
                    "Cook.",
                    "When it clicks to 'Warm', toss in {scale} slice(s) of butter.",
                    "Close lid for 1 min to melt, then fluff."
                ],
                tip: "Add butter AFTER cooking for a glossy hawker-style finish."
            },
            {
                id: 4,
                title: "Hainanese Chicken Rice",
                time: "35 mins",
                diff: "Medium",
                tag: "SG Classic",
                image: "https://nomadette.com/wp-content/uploads/2023/08/Rice-Cooker-Chicken-Rice.jpg",
                desc: "Get hawker center vibes with zero boiling pots.",
                ingredients: ["1 cup Rice", "1 cup Chicken Stock", "1 Boneless Chicken Thigh", "2 slices Ginger", "1 tsp Sesame oil"],
                steps: [
                    "Rub salt and sesame oil on {scale} chicken thigh(s).",
                    "Put washed rice in pot with stock, ginger, and garlic.",
                    "Place {scale} chicken thigh(s) skin-side up on top of rice.",
                    "Run regular rice cycle.",
                    "Rest for 5 mins, remove chicken, slice and serve."
                ],
                tip: "Use chicken stock instead of water for that deep flavor."
            },
            {
                id: 5,
                title: "Egg Fried Rice",
                time: "15 mins",
                diff: "Hard",
                tag: "Leftover Rescue",
                image: "https://dailynexus.s3.us-west-1.amazonaws.com/dailynexus/wp-content/uploads/2020/02/Snapchat-1675302673.jpg",
                desc: "The ultimate fix for using up leftover rice.",
                ingredients: ["1 bowl Leftover Rice (Cold)", "2 Eggs (beaten)", "1 clove Garlic", "2 tbsp Frozen veggies", "Soy sauce & Sugar"],
                steps: [
                    "Break up clumps in {scale} bowl(s) of cold rice.",
                    "Fry {scale} clove(s) of garlic and veggies in oil for 1 min.",
                    "Add rice. Stir-fry high heat until 'jumping'.",
                    "Push rice aside, scramble {scale} Ã— 2 eggs in empty space.",
                    "Mix, season with soy sauce/sugar, toss and serve."
                ],
                tip: "Must use OVERNIGHT rice. Fresh rice turns to mush."
            }
        ];

        const grid = document.getElementById('recipeGrid');
        let isLoading = false;
        let currentRecipeId = null;
        let currentPortionScale = 1;
        let originalIngredients = [];
        
        // Parse ingredient quantity from string
        function parseIngredient(ingredient) {
            // Match patterns like "1 cup", "1/2 tsp", "2 tbsp", etc.
            const fractionMap = {'Â½': 0.5, 'Â¼': 0.25, 'Â¾': 0.75, 'â…“': 0.33, 'â…”': 0.67, 'â…›': 0.125};
            
            // Replace fraction characters
            let normalized = ingredient;
            for (const [frac, val] of Object.entries(fractionMap)) {
                normalized = normalized.replace(frac, val.toString());
            }
            
            // Try to extract number at the beginning
            const match = normalized.match(/^([\d.]+(?:\/[\d.]+)?)(\s+)(.+)/);
            if (match) {
                let quantity = match[1];
                // Handle fractions like "1/2"
                if (quantity.includes('/')) {
                    const parts = quantity.split('/');
                    quantity = parseFloat(parts[0]) / parseFloat(parts[1]);
                } else {
                    quantity = parseFloat(quantity);
                }
                return {
                    quantity: quantity,
                    unit: match[3],
                    hasQuantity: true
                };
            }
            return {
                quantity: null,
                unit: ingredient,
                hasQuantity: false
            };
        }
        
        // Format scaled ingredient
        function formatIngredient(parsed, scale) {
            if (!parsed.hasQuantity) {
                return parsed.unit;
            }
            
            let scaledQty = parsed.quantity * scale;
            
            // Format as fraction if appropriate
            if (scaledQty === 0.5) return `Â½ ${parsed.unit}`;
            if (scaledQty === 0.25) return `Â¼ ${parsed.unit}`;
            if (scaledQty === 0.75) return `Â¾ ${parsed.unit}`;
            if (scaledQty === 0.33 || scaledQty === 0.34) return `â…“ ${parsed.unit}`;
            if (scaledQty === 0.67 || scaledQty === 0.66) return `â…” ${parsed.unit}`;
            
            // Round to reasonable precision
            if (scaledQty < 1) {
                scaledQty = Math.round(scaledQty * 100) / 100;
            } else if (scaledQty < 10) {
                scaledQty = Math.round(scaledQty * 10) / 10;
            } else {
                scaledQty = Math.round(scaledQty);
            }
            
            return `${scaledQty} ${parsed.unit}`;
        }
        
        // Helper function to replace {scale} placeholders in text
        function replaceScalePlaceholders(text, scale) {
            return text.replace(/{scale}/g, scale);
        }
        
        function setPortionScale(scale) {
            currentPortionScale = scale;
            
            // Update button styles
            document.querySelectorAll('.portion-btn').forEach(btn => {
                if (parseInt(btn.dataset.scale) === scale) {
                    btn.classList.add('bg-chef-primary', 'text-white', 'border-chef-primary');
                    btn.classList.remove('bg-white', 'border-chef-primary_light');
                } else {
                    btn.classList.remove('bg-chef-primary', 'text-white', 'border-chef-primary');
                    btn.classList.add('bg-white', 'border-chef-primary_light');
                }
            });
            
            // Update ingredient quantities
            const ingredientsList = document.getElementById('modalIngredients');
            ingredientsList.innerHTML = originalIngredients.map(ingredient => {
                const parsed = parseIngredient(ingredient);
                const scaled = formatIngredient(parsed, scale);
                return `<li class="flex items-start gap-2 cursor-pointer hover:bg-chef-subtle p-2 rounded-xl transition" onclick="toggleIngredient(this)">
                    <i class="fa-solid fa-check text-chef-primary mt-1"></i> 
                    <span class="ingredient-text">${scaled}</span>
                </li>`;
            }).join('');
            
            // Update steps with scaled text
            const recipe = recipes.find(r => r.id === currentRecipeId);
            if (recipe) {
                document.getElementById('modalSteps').innerHTML = recipe.steps.map((s, index) => {
                    const scaledStep = replaceScalePlaceholders(s, scale);
                    return `<div class="flex gap-4">
                        <span class="font-serif font-bold text-2xl text-gray-200">${index + 1}</span>
                        <p class="mt-1 leading-relaxed">${scaledStep}</p>
                    </div>`;
                }).join('');
            }
        }
        
        function showSkeletonLoading() {
            isLoading = true;
            grid.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const skeleton = document.createElement('div');
                skeleton.className = 'animate-pulse';
                skeleton.innerHTML = `
                    <div class="skeleton rounded-xl mb-4 aspect-[4/3]"></div>
                    <div class="skeleton h-6 rounded mb-2 w-3/4"></div>
                    <div class="skeleton h-4 rounded w-1/2"></div>
                `;
                grid.appendChild(skeleton);
            }
        }
        
        function renderRecipes(data, showLoading = true) {
            if (showLoading && !isLoading) {
                showSkeletonLoading();
                setTimeout(() => {
                    isLoading = false;
                    actualRender(data);
                }, 500);
            } else {
                actualRender(data);
            }
        }
        
        function actualRender(data) {
            grid.innerHTML = '';
            
            if (data.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="text-6xl mb-4">ðŸ˜ž</div>
                        <h3 class="font-serif text-3xl font-bold text-chef-dark mb-2">No recipes found!</h3>
                        <p class="text-gray-500 mb-6">Try clearing your filters or explore other categories.</p>
                        <button onclick="filterBy('all')" class="bg-chef-orange text-white px-6 py-3 rounded-full hover:bg-chef-dark transition font-medium">
                            Show All Recipes
                        </button>
                    </div>
                `;
                return;
            }
            
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = "group cursor-pointer relative bg-white rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden border border-chef-primary_light/20";
                card.innerHTML = `
                    <div class="relative overflow-hidden aspect-[4/3]" onclick="openModal(${item.id})">
                        <img src="${item.image}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent group-hover:from-transparent transition-all duration-500"></div>
                        <div class="absolute bottom-4 left-4 bg-white/95 backdrop-blur-sm px-3 py-1.5 text-xs font-bold uppercase tracking-wider rounded-full shadow-lg border border-chef-primary_light/30">
                            ${item.tag}
                        </div>
                        <button onclick="event.stopPropagation(); toggleHeart(this)" class="heart-btn absolute top-4 right-4 w-11 h-11 min-h-[44px] bg-white/95 backdrop-blur-sm rounded-3xl flex items-center justify-center shadow-lg hover:scale-110 transition-all duration-300 border border-chef-primary_light/30">
                            <i class="fa-regular fa-heart text-chef-primary text-lg"></i>
                        </button>
                    </div>
                    <div class="p-5">
                        <h3 class="font-serif text-xl md:text-2xl font-bold leading-tight mb-3 text-chef-dark group-hover:text-chef-primary transition-colors" onclick="openModal(${item.id})">${item.title}</h3>
                        <div class="flex items-center gap-4 text-xs font-medium uppercase tracking-widest pt-3 border-t border-chef-primary_light/30">
                            <span class="text-chef-gray"><i class="fa-regular fa-clock mr-1"></i> ${item.time}</span>
                            <span class="${getDifficultyColor(item.diff)}"><i class="fa-solid fa-signal mr-1"></i> ${item.diff}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        const modal = document.getElementById('recipeModal');
        const modalPanel = document.getElementById('modalPanel');

        function openModal(id) {
            const data = recipes.find(r => r.id === id);
            currentRecipeId = id;
            currentPortionScale = 1;
            originalIngredients = [...data.ingredients];
            
            document.getElementById('modalImage').src = data.image;
            document.getElementById('modalTitle').innerText = data.title;
            document.getElementById('modalDesc').innerText = data.desc;
            document.getElementById('modalTag').innerText = data.tag;
            document.getElementById('modalTime').innerText = data.time;
            document.getElementById('modalDiff').innerText = data.diff;
            document.getElementById('modalTip').innerText = data.tip;

            document.getElementById('modalIngredients').innerHTML = data.ingredients.map(i => 
                `<li class="flex items-start gap-2 cursor-pointer hover:bg-chef-subtle p-2 rounded-xl transition" onclick="toggleIngredient(this)">
                    <i class="fa-solid fa-check text-chef-primary mt-1"></i> 
                    <span class="ingredient-text">${i}</span>
                </li>`
            ).join('');
            
            document.getElementById('modalSteps').innerHTML = data.steps.map((s, index) => 
                `<div class="flex gap-4">
                    <span class="font-serif font-bold text-2xl text-gray-200">${index + 1}</span>
                    <p class="mt-1 leading-relaxed">${s}</p>
                </div>`
            ).join('');
            
            // Reset portion scale buttons
            document.querySelectorAll('.portion-btn').forEach(btn => {
                if (btn.dataset.scale === '1') {
                    btn.classList.add('bg-chef-primary', 'text-white', 'border-chef-primary');
                    btn.classList.remove('bg-white', 'border-chef-primary_light');
                } else {
                    btn.classList.remove('bg-chef-primary', 'text-white', 'border-chef-primary');
                    btn.classList.add('bg-white', 'border-chef-primary_light');
                }
            });

            modal.classList.remove('hidden');
            setTimeout(() => {
                modalPanel.classList.remove('translate-x-full');
            }, 10);
        }

        function closeModal() {
            modalPanel.classList.add('translate-x-full');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        function enterCookMode() {
            const recipe = recipes.find(r => r.id === currentRecipeId);
            if (!recipe) return;
            
            // Populate Cook Mode
            document.getElementById('cookModeTitle').textContent = recipe.title;
            document.getElementById('cookModeTip').textContent = recipe.tip;
            
            // Get scaled ingredients
            const scaledIngredients = originalIngredients.map(ingredient => {
                const parsed = parseIngredient(ingredient);
                return formatIngredient(parsed, currentPortionScale);
            });
            
            document.getElementById('cookModeIngredients').innerHTML = scaledIngredients.map(i => 
                `<li class="flex items-start gap-3">
                    <i class="fa-solid fa-circle text-chef-primary text-xs mt-2"></i>
                    <span>${i}</span>
                </li>`
            ).join('');
            
            // Get scaled steps with placeholders replaced
            const scaledSteps = recipe.steps.map(step => replaceScalePlaceholders(step, currentPortionScale));
            
            document.getElementById('cookModeSteps').innerHTML = scaledSteps.map((step, index) => 
                `<label class="flex items-start gap-4 p-4 bg-chef-subtle hover:bg-chef-primary/5 rounded-3xl cursor-pointer transition-all border-2 border-transparent hover:border-chef-primary_light" onclick="toggleCookStep(this)">
                    <input type="checkbox" class="mt-2 w-6 h-6 text-chef-primary rounded-lg focus:ring-chef-primary cursor-pointer">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="w-8 h-8 bg-gradient-to-br from-chef-primary to-chef-primary_dark text-white rounded-lg flex items-center justify-center font-bold text-sm shadow-sm">${index + 1}</span>
                            <span class="font-bold text-base md:text-lg text-chef-dark">Step ${index + 1}</span>
                        </div>
                        <p class="text-base md:text-xl text-gray-700 leading-relaxed step-text">${step}</p>
                    </div>
                </label>`
            ).join('');
            
            document.getElementById('cookModeTotal').textContent = recipe.steps.length;
            document.getElementById('cookModeProgress').textContent = '0';
            
            // Show overlay
            document.getElementById('cookModeOverlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function exitCookMode() {
            document.getElementById('cookModeOverlay').classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        function toggleCookStep(label) {
            const checkbox = label.querySelector('input[type="checkbox"]');
            const stepText = label.querySelector('.step-text');
            
            // Update styling
            setTimeout(() => {
                if (checkbox.checked) {
                    stepText.style.textDecoration = 'line-through';
                    stepText.style.opacity = '0.5';
                    label.classList.add('bg-chef-primary/10');
                } else {
                    stepText.style.textDecoration = 'none';
                    stepText.style.opacity = '1';
                    label.classList.remove('bg-chef-primary/10');
                }
                
                // Update progress
                const total = document.querySelectorAll('#cookModeSteps input[type="checkbox"]').length;
                const checked = document.querySelectorAll('#cookModeSteps input[type="checkbox"]:checked').length;
                document.getElementById('cookModeProgress').textContent = checked;
            }, 0);
        }

        function filterBy(type) {
            document.querySelectorAll('.nav-filter').forEach(btn => {
                btn.classList.remove('text-chef-primary', 'border-chef-primary');
                btn.classList.add('border-transparent');
            });
            
            let activeBtn;
            if(type === 'all') {
                activeBtn = document.getElementById('filter-all');
                renderRecipes(recipes);
            } else if(type === 'Vegetarian') {
                activeBtn = document.getElementById('filter-veg');
                const veg = recipes.filter(r => r.tag.includes('Vegetarian') || r.title.includes('Tomato'));
                renderRecipes(veg);
            } else {
                activeBtn = document.getElementById('filter-easy');
                renderRecipes(recipes.filter(r => r.diff === type));
            }
            
            if (activeBtn) {
                activeBtn.classList.add('text-chef-primary', 'border-chef-primary');
                activeBtn.classList.remove('border-transparent');
            }
        }

        function toggleHeart(btn) {
            const icon = btn.querySelector('i');
            if (icon.classList.contains('fa-regular')) {
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid');
                icon.classList.add('text-rose-500');
                icon.classList.remove('text-chef-primary');
            } else {
                icon.classList.add('fa-regular');
                icon.classList.remove('fa-solid');
                icon.classList.remove('text-rose-500');
                icon.classList.add('text-chef-primary');
            }
        }
        
        function toggleIngredient(element) {
            const textSpan = element.querySelector('.ingredient-text');
            const icon = element.querySelector('i');
            
            if (textSpan.style.textDecoration === 'line-through') {
                textSpan.style.textDecoration = 'none';
                textSpan.style.opacity = '1';
                icon.classList.remove('fa-circle-check');
                icon.classList.add('fa-check');
                element.classList.remove('opacity-50');
            } else {
                textSpan.style.textDecoration = 'line-through';
                textSpan.style.opacity = '0.5';
                icon.classList.remove('fa-check');
                icon.classList.add('fa-circle-check');
                element.classList.add('opacity-50');
            }
        }
        
        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'Very Easy':
                    return 'text-green-600';
                case 'Easy':
                    return 'text-green-500';
                case 'Medium':
                    return 'text-yellow-600';
                case 'Hard':
                    return 'text-red-600';
                default:
                    return 'text-gray-500';
            }
        }
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function surpriseMe() {
            const recipeCards = document.querySelectorAll('#recipeGrid > div');
            if (recipeCards.length === 0) return;
            
            let shuffleCount = 0;
            const maxShuffles = 8;
            const shuffleInterval = 150;
            
            const shuffleTimer = setInterval(() => {
                // Highlight random card
                recipeCards.forEach(card => card.classList.remove('shuffle-animation', 'ring-4', 'ring-chef-primary'));
                const randomCard = recipeCards[Math.floor(Math.random() * recipeCards.length)];
                randomCard.classList.add('shuffle-animation', 'ring-4', 'ring-chef-primary');
                
                shuffleCount++;
                
                if (shuffleCount >= maxShuffles) {
                    clearInterval(shuffleTimer);
                    // Select final random recipe
                    setTimeout(() => {
                        const finalRecipe = recipes[Math.floor(Math.random() * recipes.length)];
                        openModal(finalRecipe.id);
                        recipeCards.forEach(card => card.classList.remove('shuffle-animation', 'ring-4', 'ring-chef-primary'));
                    }, 300);
                }
            }, shuffleInterval);
        }

        function printRecipe() {
            window.print();
        }
        
        async function shareRecipe() {
            const recipe = recipes.find(r => r.id === currentRecipeId);
            if (!recipe) return;
            
            const shareData = {
                title: `Rice Station - ${recipe.title}`,
                text: `Check out this ${recipe.tag} recipe: ${recipe.title}`,
                url: window.location.href
            };
            
            // Try native share API first (mobile)
            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                    showToast('Recipe shared successfully!');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.log('Share failed:', err);
                    }
                }
            } else {
                // Fallback: Copy to clipboard
                try {
                    await navigator.clipboard.writeText(window.location.href);
                    showToast('Link copied to clipboard!');
                } catch (err) {
                    showToast('Could not copy link', 'error');
                }
            }
        }
        
        function addRecipeToMealPlan(recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            // Get current meal plan from localStorage
            let mealPlan = JSON.parse(localStorage.getItem('mealPlan') || '[]');
            
            // Check if recipe already exists
            if (mealPlan.some(r => r.id === recipeId)) {
                showToast('Recipe already in meal plan!', 'warning');
                return;
            }
            
            // Add recipe
            mealPlan.push(recipe);
            localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
            
            updateMealPlanUI();
            showToast(`Added "${recipe.title}" to meal plan!`);
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const icon = toast.querySelector('i');
            
            toastMessage.textContent = message;
            
            // Update icon based on type
            icon.className = type === 'error' ? 'fa-solid fa-exclamation-circle text-rose-500' : 
                           type === 'warning' ? 'fa-solid fa-info-circle text-amber-500' :
                           'fa-solid fa-check-circle text-chef-primary';
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }
        
        // Confirmation modal functions
        let confirmCallback = null;
        
        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            confirmCallback = onConfirm;
            document.getElementById('confirmModal').classList.remove('hidden');
        }
        
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.add('hidden');
            confirmCallback = null;
        }
        
        function handleConfirm() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeConfirmModal();
        }
        
        // Attach confirm handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('confirmBtn')?.addEventListener('click', handleConfirm);
        });
        
        function showClearConfirmModal() {
            showConfirmModal(
                'Clear Meal Plan',
                'Are you sure you want to remove all recipes from your meal plan?',
                clearMealPlan
            );
        }

        let mealPlanOpen = false;
        
        // Initialize meal plan on page load
        function initMealPlan() {
            updateMealPlanUI();
        }
        
        function toggleMealPlan() {
            const sidebar = document.getElementById('mealPlanSidebar');
            mealPlanOpen = !mealPlanOpen;
            
            if (mealPlanOpen) {
                sidebar.classList.remove('translate-x-full');
                updateMealPlanUI();
            } else {
                sidebar.classList.add('translate-x-full');
            }
        }
        
        function updateMealPlanUI() {
            const mealPlan = JSON.parse(localStorage.getItem('mealPlan') || '[]');
            const listContainer = document.getElementById('mealPlanList');
            const countBadge = document.getElementById('mealPlanCount');
            const subtitle = document.getElementById('mealPlanSubtitle');
            const generateBtn = document.getElementById('generateListBtn');
            
            // Update count badge
            if (mealPlan.length > 0) {
                countBadge.textContent = mealPlan.length;
                countBadge.classList.remove('hidden');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                countBadge.classList.add('hidden');
                generateBtn.disabled = true;
                generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
            
            // Update subtitle
            subtitle.textContent = mealPlan.length === 0 ? 'No recipes saved yet' : 
                                  `${mealPlan.length} recipe${mealPlan.length > 1 ? 's' : ''} saved`;
            
            // Render meal plan list
            if (mealPlan.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ðŸ“…</div>
                        <h4 class="font-serif text-xl font-bold text-chef-dark mb-2">Start Planning Your Meals</h4>
                        <p class="text-sm text-gray-500">Add recipes to your meal plan to get started!</p>
                    </div>
                `;
            } else {
                listContainer.innerHTML = mealPlan.map(recipe => `
                    <div class="mb-4 bg-white rounded-3xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-chef-primary_light/20">
                        <div class="flex gap-3 p-3">
                            <img src="${recipe.image}" class="w-20 h-20 object-cover rounded-3xl flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-sm text-chef-dark mb-1 truncate">${recipe.title}</h4>
                                <p class="text-xs text-chef-gray mb-2">${recipe.time} â€¢ ${recipe.diff}</p>
                                <div class="flex gap-2">
                                    <button onclick="openModal(${recipe.id}); toggleMealPlan();" class="text-xs font-medium text-chef-primary hover:text-chef-primary_dark transition min-h-[32px] px-2">
                                        <i class="fa-solid fa-eye mr-1"></i>View
                                    </button>
                                    <button onclick="removeFromMealPlan(${recipe.id})" class="text-xs font-medium text-rose-600 hover:text-rose-800 transition min-h-[32px] px-2">
                                        <i class="fa-solid fa-trash mr-1"></i>Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function removeFromMealPlan(recipeId) {
            let mealPlan = JSON.parse(localStorage.getItem('mealPlan') || '[]');
            mealPlan = mealPlan.filter(r => r.id !== recipeId);
            localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
            updateMealPlanUI();
            showToast('Recipe removed from meal plan');
        }
        
        function clearMealPlan() {
            localStorage.removeItem('mealPlan');
            updateMealPlanUI();
            showToast('Meal plan cleared');
        }
        
        function generateShoppingList() {
            const mealPlan = JSON.parse(localStorage.getItem('mealPlan') || '[]');
            if (mealPlan.length === 0) return;
            
            // Aggregate all ingredients
            const allIngredients = [];
            mealPlan.forEach(recipe => {
                recipe.ingredients.forEach(ingredient => {
                    allIngredients.push({
                        text: ingredient,
                        recipe: recipe.title,
                        checked: false
                    });
                });
            });
            
            // Render shopping list
            const content = document.getElementById('shoppingListContent');
            const subtitle = document.getElementById('shoppingListSubtitle');
            
            subtitle.textContent = `${allIngredients.length} items from ${mealPlan.length} recipes`;
            
            content.innerHTML = `
                <div class="space-y-4">
                    ${mealPlan.map(recipe => `
                        <div class="mb-6">
                            <h4 class="font-bold text-chef-dark mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-utensils text-chef-primary"></i>
                                ${recipe.title}
                            </h4>
                            <div class="space-y-2 pl-8">
                                ${recipe.ingredients.map((ingredient, idx) => `
                                    <label class="flex items-start gap-3 cursor-pointer hover:bg-chef-subtle p-2 rounded-xl transition">
                                        <input type="checkbox" onchange="toggleShoppingItem(this)" class="mt-1 w-5 h-5 min-h-[20px] text-chef-primary rounded focus:ring-chef-primary">
                                        <span class="text-sm text-gray-700 shopping-item-text">${ingredient}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Show modal
            document.getElementById('shoppingListModal').classList.remove('hidden');
        }
        
        function toggleShoppingItem(checkbox) {
            const text = checkbox.parentElement.querySelector('.shopping-item-text');
            if (checkbox.checked) {
                text.style.textDecoration = 'line-through';
                text.style.opacity = '0.5';
            } else {
                text.style.textDecoration = 'none';
                text.style.opacity = '1';
            }
        }
        
        function closeShoppingList() {
            document.getElementById('shoppingListModal').classList.add('hidden');
        }
        
        function printShoppingList() {
            window.print();
        }
        

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('filter-all')?.classList.add('text-chef-primary', 'border-chef-primary');
            initMealPlan();
        });

        renderRecipes(recipes, false);
    </script>

    <!-- Flowise Embed -->
    <script type="module">
        import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"
        Chatbot.init({
            chatflowid: "dba2ba8c-4d7c-47af-9ab7-0be9023dbfbd",
            apiHost: "https://cloud.flowiseai.com",
            theme: {
                button: {
                    backgroundColor: "#5B8FB9", // Pacific Blue
                    iconColor: "white",
                    customIconSrc: "https://cdn-icons-png.flaticon.com/512/2040/2040946.png", // Chef Hat Icon
                },
                chatWindow: {
                    welcomeMessage: "Hello! I am your Rice Station Chef. Ask me about recipes, leftovers, or cooking tips!",
                    backgroundColor: "#ffffff",
                    botMessage: {
                        backgroundColor: "#FDFBF7", // Cream
                        textColor: "#304D6D", // Navy
                    },
                    userMessage: {
                        backgroundColor: "#5B8FB9", // Pacific Blue
                        textColor: "#ffffff",
                    },
                    textInput: {
                        placeholder: "Ask about rice recipes...",
                        backgroundColor: "#ffffff",
                        textColor: "#304D6D",
                    }
                }
            }
        })
    </script>
</body>
</html>